#!/bin/bash
set -eu
project="${1:-$(gcloud config get project 2>/dev/null)}"

gcloud asset list --project="$project" --format=json |
  # ancestors is always a list of one -- the project
  jq '
    .[]
    | del(.ancestors)
    # its much more useful if the object name is separated from the api name
    | .api = ( .name | split("/")[2] )
    | .name = ( .name | split("/")[3:] | join("/") )
  ' -c
###    | .api = .name | split("/")[2])
###    | .name = (.name | .split("/")[3:] | join("/"))
